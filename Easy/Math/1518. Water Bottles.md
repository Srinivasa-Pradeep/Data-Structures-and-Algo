# Water Bottles Exchange Problem – Notes

## 📝 Problem Restatement

* You start with `numBottles` full water bottles.
* Drinking a bottle → gives **1 empty bottle**.
* You can exchange `numExchange` empty bottles for **1 full bottle**.
* Find the **maximum number of bottles you can drink**.

---

## 🔑 Core Idea

It’s a **repeat-until-empty** cycle:

1. Drink full → add empties.
2. Trade empties → gain new full bottles.
3. Repeat until empties < `numExchange`.

You only need to track two numbers:

* `drank` → total bottles consumed.
* `empty` → how many empty bottles are available for exchange.

---

## 🌀 Simulation (Loop Approach)

Step-by-step:

* Start with `drank = numBottles` and `empty = numBottles`.
* While `empty >= numExchange`:

  * `new_bottles = empty // numExchange`
  * `drank += new_bottles`
  * `empty = empty % numExchange + new_bottles`

### Code

```python
class Solution:
    def numWaterBottles(self, numBottles: int, numExchange: int) -> int:
        drank = numBottles
        empty = numBottles
        
        while empty >= numExchange:
            new_bottles = empty // numExchange
            drank += new_bottles
            empty = empty % numExchange + new_bottles
        
        return drank
```

---

## 🧮 Formula Approach (Math Trick)

Observation:

* Each exchange uses `numExchange` empties but gives **1 back** (after drinking).
* Net empties lost per exchange cycle = `numExchange - 1`.
* So total extra bottles = `(numBottles - 1) // (numExchange - 1)`
  (subtract `1` to avoid overcounting the final impossible trade).

### Formula

```
total = numBottles + (numBottles - 1) // (numExchange - 1)
```

### Code

```python
class Solution:
    def numWaterBottles(self, numBottles: int, numExchange: int) -> int:
        return numBottles + (numBottles - 1) // (numExchange - 1)
```

---

## 🔍 Example Walkthroughs

### Example 1

`numBottles = 9, numExchange = 3`

* Loop: 9 → trade 9→3 → drink 3 → trade 3→1 → total = 13.
* Formula: `9 + (9-1)//(3-1) = 9 + 4 = 13`.

✅ Matches.

---

### Example 2

`numBottles = 15, numExchange = 4`

* Loop: 15 → trade 15→3 → drink → trade again → total = 19.
* Formula: `15 + (15-1)//(4-1) = 15 + 4 = 19`.

✅ Matches.

---

## 🧠 How to Think Like This in Future

1. **Start small** → test with tiny numbers.
2. **Track net changes** per cycle (what you lose vs gain).
3. **Spot the invariant** → here it’s “each new bottle costs (numExchange - 1) empties net.”
4. **Check edge cases** → 1 bottle must return 1.
5. **Convert to formula** → only if pattern is very clear.

---

## ✨ Key Takeaways

* Loop approach = intuitive, easy to implement.
* Formula approach = elegant, but needs careful reasoning.
* `(numBottles - 1)` handles the last impossible trade.
* Always test edge cases to avoid overcounting.


