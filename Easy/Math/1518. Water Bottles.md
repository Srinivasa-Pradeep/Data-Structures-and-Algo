# Water Bottles Exchange Problem â€“ Notes

## ğŸ“ Problem Restatement

* You start with `numBottles` full water bottles.
* Drinking a bottle â†’ gives **1 empty bottle**.
* You can exchange `numExchange` empty bottles for **1 full bottle**.
* Find the **maximum number of bottles you can drink**.

---

## ğŸ”‘ Core Idea

Itâ€™s a **repeat-until-empty** cycle:

1. Drink full â†’ add empties.
2. Trade empties â†’ gain new full bottles.
3. Repeat until empties < `numExchange`.

You only need to track two numbers:

* `drank` â†’ total bottles consumed.
* `empty` â†’ how many empty bottles are available for exchange.

---

## ğŸŒ€ Simulation (Loop Approach)

Step-by-step:

* Start with `drank = numBottles` and `empty = numBottles`.
* While `empty >= numExchange`:

  * `new_bottles = empty // numExchange`
  * `drank += new_bottles`
  * `empty = empty % numExchange + new_bottles`

### Code

```python
class Solution:
    def numWaterBottles(self, numBottles: int, numExchange: int) -> int:
        drank = numBottles
        empty = numBottles
        
        while empty >= numExchange:
            new_bottles = empty // numExchange
            drank += new_bottles
            empty = empty % numExchange + new_bottles
        
        return drank
```

---

## ğŸ§® Formula Approach (Math Trick)

Observation:

* Each exchange uses `numExchange` empties but gives **1 back** (after drinking).
* Net empties lost per exchange cycle = `numExchange - 1`.
* So total extra bottles = `(numBottles - 1) // (numExchange - 1)`
  (subtract `1` to avoid overcounting the final impossible trade).

### Formula

```
total = numBottles + (numBottles - 1) // (numExchange - 1)
```

### Code

```python
class Solution:
    def numWaterBottles(self, numBottles: int, numExchange: int) -> int:
        return numBottles + (numBottles - 1) // (numExchange - 1)
```

---

## ğŸ” Example Walkthroughs

### Example 1

`numBottles = 9, numExchange = 3`

* Loop: 9 â†’ trade 9â†’3 â†’ drink 3 â†’ trade 3â†’1 â†’ total = 13.
* Formula: `9 + (9-1)//(3-1) = 9 + 4 = 13`.

âœ… Matches.

---

### Example 2

`numBottles = 15, numExchange = 4`

* Loop: 15 â†’ trade 15â†’3 â†’ drink â†’ trade again â†’ total = 19.
* Formula: `15 + (15-1)//(4-1) = 15 + 4 = 19`.

âœ… Matches.

---

## ğŸ§  How to Think Like This in Future

1. **Start small** â†’ test with tiny numbers.
2. **Track net changes** per cycle (what you lose vs gain).
3. **Spot the invariant** â†’ here itâ€™s â€œeach new bottle costs (numExchange - 1) empties net.â€
4. **Check edge cases** â†’ 1 bottle must return 1.
5. **Convert to formula** â†’ only if pattern is very clear.

---

## âœ¨ Key Takeaways

* Loop approach = intuitive, easy to implement.
* Formula approach = elegant, but needs careful reasoning.
* `(numBottles - 1)` handles the last impossible trade.
* Always test edge cases to avoid overcounting.


