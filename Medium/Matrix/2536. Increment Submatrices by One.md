

# ðŸ“˜ **Matrix Range Addition â€” Difference Array Solution**

### **ðŸ”¥ Problem Summary**

Youâ€™re given:

* An empty **n Ã— n** matrix `mat` filled with `0`s
* A list of **queries**, where each query is
  [
  [row1, col1, row2, col2]
  ]
* For each query, you must **add 1** to every cell in that rectangular region.

Finally, return the updated matrix.

Brute force would be too slow (O(q Ã— nÂ²)).
Letâ€™s do this the smart way â€” like a real engineer.

---

# ðŸš€ **Optimal Approach: 2D Difference Array**

### ðŸ§  Core Idea

Instead of incrementing every cell for every query,
we **mark only the boundaries** of each query in a difference matrix.

After processing all queries,
we build prefix sums to reconstruct the final matrix.

This makes the entire algorithm **O(nÂ² + q)** â€” beautifully efficient.

---

# ðŸ§© Step-by-Step Logic

### For each query `[r1, c1, r2, c2]`:

You:

* `+1` at `(r1, c1)`
* `-1` at `(r1, c2+1)` if valid
* `-1` at `(r2+1, c1)` if valid
* `+1` at `(r2+1, c2+1)` if valid

Then:

1. Build row-wise prefix sums
2. Build column-wise prefix sums
3. Done â€” your matrix is ready.

---

# âœ… **Python Code (Clean & Efficient)**

```python
class Solution:
    def rangeAddQueries(self, n: int, queries: List[List[int]]) -> List[List[int]]:
        diff = [[0] * (n + 1) for _ in range(n + 1)]
        
        for r1, c1, r2, c2 in queries:
            diff[r1][c1] += 1
            if c2 + 1 < n:
                diff[r1][c2 + 1] -= 1
            if r2 + 1 < n:
                diff[r2 + 1][c1] -= 1
            if r2 + 1 < n and c2 + 1 < n:
                diff[r2 + 1][c2 + 1] += 1
        
        # Row prefix
        for i in range(n):
            for j in range(1, n):
                diff[i][j] += diff[i][j - 1]
        
        # Column prefix
        for j in range(n):
            for i in range(1, n):
                diff[i][j] += diff[i - 1][j]
        
        # Trim n x n
        return [row[:n] for row in diff[:n]]
```

---

# ðŸ§ª Example

If you have `n = 3` and:

```
queries = [
  [0,0,1,1],
  [1,1,2,2]
]
```

Final matrix becomes:

```
[
  [1,1,0],
  [1,2,1],
  [0,1,1]
]
```

Every increment is captured perfectly by prefix sums.

---

# ðŸŽ¯ **Why This Works Beautifully**

* No repeated updates
* No nested loops per query
* Perfect for large matrices
* Uses the classic *2D difference array* pattern â€” a must-know technique for advanced interviews

This is the kind of solution that makes interviewers raise their eyebrows a little â€” the good way ðŸ˜„

---
